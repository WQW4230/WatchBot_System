# STM32 WatchBot_Controi
项目简介
本仓库是一个基于 STM32F103C8T6（主控）与 ESP32-S3-CAM（视觉）构建的模块化双 MCU 嵌入式平台。平台集成自研轻量级调度系统 FunOS、机械臂控制、红外菜单与 OLED/TFT 界面，并实现人脸识别追踪报警与实时画面传输。整体设计面向工程可用：模块化、可配置、易扩展的小型项目

核心功能概览

1. 调度器 FunOS

* 仿 FreeRTOS 风格的轻量实时调度器。
* 支持任务创建/删除与周期调度（基于系统时钟）。
* 支持非阻塞延时（通过时间判断而非阻塞等待）。
* 支持设定延时后再调度任务（允许任务在过期后被调度执行）。
* 缺点不支持上下文切换和抢占式执行，
* 该程序框架下的任务应保持非阻塞、单次轮询不超过2ms

2. 菜单与 UI

* 0.96" OLED：用于 STM32F103 的菜单界面、参数显示与游戏（贪吃蛇、扫雷、猜数字）。驱动程序采用江协科技0.96寸OLED
* 2.8" TFT（通过 ESP32-S3-CAM 或 SPI）：可显示实时摄像头画面。该驱动程序采用EPS官方例程驱动程序
* 红外遥控多级菜单，软件表在menu.c中，拓展性强，添加软件名字及对应的进程函数即可使用
* 红外遥控交互：上下左右、OK、星号（返回）、井号（清除）及数字键输入。
* 菜单功能：RTC 实时时钟设置、闹钟设置与蜂鸣器报警、游戏、通讯录管理、LED 调速、摄像头旁闪光灯控制、机械臂配置与动作管理。

3. 实时时钟与闹钟

* 集成 RTC，可以设置本地时间、日期并显示。
* 支持设置闹钟并触发蜂鸣器报警。
* 菜单内可调时间、启停闹钟、测试蜂鸣器。

4. 机械臂（3 轴）

* 结构：基座旋转Base（Yaw）、中间翻滚（Roll）、末端俯仰（Pitch），搭载一个风扇/舵机作为外设。
* 控制模式：遥控控制、摇杆控制、自动控制（由 ESP32 人脸追踪下发目标坐标）、动作选择（动作表播放）。
* 控制细节：双摇杆支持、双死区过滤（ADC 死区与角度死区）、四种舵机模式选择。
* 平滑控制：基于简单的 PID/比例平滑算法（当前值与目标值按系数混合），平滑度可调。
* 支持动作表（表驱动），动作定义为目标角度与持续时间的数组，动作表以 const 放在 Arm_Action_Data.c 中并在 Arm_Action_Data.h 中 extern 声明。

6. 通信协议（STM32 ↔ ESP32）

* 使用 USART TTL 通信，命令集为文本或二进制帧（含帧头、长度校验、命令ID、数据、帧尾）。
* ESP32 下发人脸追踪解算参数（目标 yaw/roll/pitch/fanspeed），蜂鸣器蜂鸣频率，STM32 接收并转换为目标角度执行。
* STM32上传LED指示灯参数控制摄像头闪光灯以及ESP32指示灯测试双方收发通信

7. 游戏与扩展功能

* 贪吃蛇、扫雷、猜数字等小游戏运行于 STM32 菜单界面（OLED），可用红外操作。
* 通讯录功能 增加/删除/查看/多键字母输入。
* LED 调速菜单用于控制板载 LED 与摄像头旁闪光灯，以及ESP板载指示灯
* STM32 与 ESP32 均有指示灯状态显示（分别用于本机与视觉模块运行状态指示）。

- 作者联系方式498644995@qq.com
- qq号498644995
- B站博主名称：9175先生
- 视频有详细介绍功能及原理

更新日志 2025/9/19
WatchBot_Contro 1.01
更新内容：修复闹钟定时在其他应用不能响应的问题

更新日志 2025/10/3
WatchBot_Contro 1.02
更新内容：修复显示舵机参数与操控舵机不相符问题
预设双MCU——USART通信指令集

更新日志 2025/10/13
WatchBot_Contro 1.03
更新内容：添加按下按提示音功能、蜂鸣器模块解耦、双MCU-USART通信驱动完成

更新日志 2025/10/14
WatchBot_Contro 1.04
更新内容：舵机电机模块解耦，RTC实时时钟解耦，PS2——ADC——DMA模块解耦

更新日志 2025/10/15
WatchBot_Contro 1.05
更新内容：IR_NEC模块解耦

更新日志 2025/10/17
WatchBot_Contro 1.06
更新内容：机械臂控制模块解耦，增添快速移动- 缓步平滑移动

更新日志 2025/10/18
WatchBot_Contro 1.07
更新内容：解耦摇杆增加双死区线性映射过滤算法，摇杆输入更平滑不抖动

更新日志 2025/10/18
WatchBot_Contro 1.08
更新内容：机械臂添加比例算法消抖,，摇杆控制机械臂模块，双死区过滤消抖

更新日志 2025/10/22
WatchBot_Contro 1.10
更新内容：重大更新，添加仿FreeRtos时间片调度器，程序框架及任务实时性优化
LED驱动和蜂鸣器驱动修复BUG，添加可调蜂鸣时间、开关

更新日志 2025/10/23
WatchBot_Contro 1.11
更新内容：可调LED界面重构解耦 界面优化，预设添加ESP32板载LED、CAM，LED设置

更新日志 2025/10/24
WatchBot_Contro 1.12
更新内容：可调LED界面优化完善，主页菜单重构解耦，拓展性增强，机械臂控制模块
修复摇杆控制直流电机BUG

更新日志 2025/10/25
WatchBot_Contro 1.13
更新内容：RTC实时时钟、闹钟模块重构解耦优化，拓展性、可读性、复用性增强
修复红外遥控器长按无效

更新日志 2025/10/26
WatchBot_Contr 1.14  新增蜂鸣器菜单，可调蜂鸣器。加载重构贪吃蛇至菜单，调度器调用，拓展性可读性增强
通讯录部分模块解耦

更新日志 2025/10/27
WatchBot_Contr 1.15  通讯录重构，扫雷部分功能重构，使用调度器轮询，猜数字重构。
机械臂模块分层，硬件驱动层 - 控制层 - 应用层
接线图重新整理

更新日志 2025/10/28
WatchBot_Contr 1.16  新增机械臂控制菜单、红外遥控机械臂菜单、摇杆控制菜单
机械臂参数显示，红外遥控可以设置机械臂角度参数

更新日志 2025/10/29
WatchBot_Contr 1.17  新增机械臂动作菜单可选两种动作demo，快速机动、摆手
修复舵机实时参数错误显示

更新日志 2025/10/31
WatchBot_Contr 1.18 新增串口接收指令集，USART下发人脸追踪解算参数
（目标 yaw/roll/pitch/fanspeed），蜂鸣器蜂鸣频率，STM32 接收并转换为目标角度执行/蜂鸣器频率

更新日志 2025/11/2
WatchBot_Contr 2.00 新增STM串口发送指令集，USART发送控制ESP32板载led以及摄像头闪光灯控制指令

更新日志 2025/11/7
WatchBot_Contr 2.01 新增ESP32S3_LCDili9341驱动程序，图像库。esp32板载LED驱动程序

更新日志 2025/11/8
WatchBot_Contr 2.02 新增ESP32S3_ov2640摄像头驱动程序，适配LCD显示屏，可将画面发送至屏幕

- 该项目完全开源
- 本项目仅供学习与研究使用，不保证功能完整或适用性。  
-使用本项目产生的任何风险和损失，由使用者自行承担。


